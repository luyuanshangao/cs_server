(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8e915262"],{"2bec":function(t,e,s){t.exports=s.p+"static/img/cust.500b7a44.jpg"},3092:function(t,e,s){},aedf:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:5}},[s("div",{staticStyle:{height:"750px"}},[s("el-row"),t._v(" "),s("el-scrollbar",{staticStyle:{height:"75%"}},t._l(t.userList,(function(e,n){return s("el-row",{key:e.name},[s("div",{staticClass:"jwt-item"},[s("JwChat-item",{attrs:{size:"25",config:e},on:{click:function(s){return t.bindClick(e,n)}}})],1)])})),1)],1)]),t._v(" "),s("el-col",{attrs:{span:19}},[s("JwChat-index",{attrs:{"tale-list":t.taleList,"tool-config":t.tool,config:t.config},on:{enter:t.bindEnter},model:{value:t.inputMsg,callback:function(e){t.inputMsg=e},expression:"inputMsg"}})],1)],1)],1)},o=[],i=s("eaa9"),a=s.n(i),c=s("2bec"),r=s.n(c),l=s("b775");function u(t){return Object(l["a"])({url:"/customer/ClientKefu/getQueue",method:"post",data:t})}function d(t){return Object(l["a"])({url:"/customer/ClientKefu/getLog",method:"get",params:t})}var f={name:"CustomerIndex",filters:{},data:function(){return{websock:null,kefuAdminId:this.$store.getters.adminId,nickName:this.$store.getters.nickName,kefuUserId:"",searchUser:"",input4:"",userList:[],inputMsg:"",taleList:[],tool:{show:["more"],callback:this.toolEvent},config:{img:a.a,name:"等待接入",dept:"",callback:this.headerEvent}}},watch:{$route:function(t,e){console.log(e)}},mounted:function(){this.scrollToBottom()},updated:function(){this.scrollToBottom()},created:function(){this.initWebSocket()},destroyed:function(){this.websock.close()},methods:{initWebSocket:function(){var t="ws://47.240.73.45:9502";this.websock=new WebSocket(t),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){var t={data:{},class:"Event",cmd:"kefuConnection"};t.data.kefuAdminId=this.kefuAdminId,this.websocketsend(JSON.stringify(t))},websocketonerror:function(){console.log("连接建立失败重连"),this.initWebSocket()},websocketonmessage:function(t){var e=JSON.parse(t.data);if("chatMessage"===e.cmd){console.log(e.data);for(var s=0;s<this.userList.length;s++)"US_"+this.userList[s].callback===e.data.fromId&&(this.userList[s].dept=e.data.message,"US_"+this.kefuUserId===e.data.fromId&&this.taleList.push({date:e.data.time,text:{text:e.data.message},mine:!1,name:e.data.fromName,img:e.data.fromAvatar?e.data.fromAvatar:a.a}))}else"kefuOnline"===e.cmd?(console.log(e),this.getQueue(1)):"userUpper"===e.cmd?(console.log("kefu--------新用户上线"),this.getQueue(1)):"diffClose"===e.cmd?(console.log("用户下线"),this.getQueue(1),this.taleList=[]):e.cmd},websocketsend:function(t){console.log("发送数据"+t),this.websock.send(t)},websocketclose:function(t){var e={data:{},class:"Event",cmd:"disconnect"};e.data.kefuAdminId=this.kefuAdminId,this.websocketsend(JSON.stringify(e))},bindClick:function(t,e){this.config=Object.assign(t),this.kefuUserId=t.callback,this.getLog(t.callback)},bindEnter:function(){var t=this.inputMsg;if(t){var e={date:"2020/05/20 23:19:07",text:{text:t},mine:!0,name:this.nickName,img:r.a};this.taleList.push(e);var s={data:{},class:"Event",cmd:"message"};s.data={fromId:"KF_"+this.kefuAdminId,fromName:"客服",fromAvatar:"",toId:"US_"+this.kefuUserId,toName:"用户",toAvatar:"",message:t},this.websocketsend(JSON.stringify(s))}},toolEvent:function(t){console.log("tools",t)},headerEvent:function(t){console.log("header",t)},getQueue:function(t){var e=this,s={kefuAdminId:this.kefuAdminId,receptionStatus:t};u(s).then((function(t){for(var s=0;s<t.length;s++)t[s].img||(t[s].img=a.a);e.userList=t}))},getLog:function(t){var e=this,s={kefuAdminId:this.kefuAdminId,kefuUserId:t};d(s).then((function(t){for(var s=0;s<t.length;s++)t[s].img||t[s].mine||(t[s].img=a.a),!t[s].img&&t[s].mine&&(t[s].img=r.a);e.taleList=t}))},scrollToBottom:function(){var t=this;this.$nextTick((function(){var e=t.$el.querySelector(".scroller");e.scrollTop=e.scrollHeight}))}}},m=f,h=(s("f853"),s("623f")),g=Object(h["a"])(m,n,o,!1,null,null,null);e["default"]=g.exports},eaa9:function(t,e,s){t.exports=s.p+"static/img/user.0afb759f.jpg"},f853:function(t,e,s){"use strict";var n=s("3092"),o=s.n(n);o.a}}]);